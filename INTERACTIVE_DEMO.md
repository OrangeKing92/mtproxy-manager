# MTProxy Manager 交互式安装演示

## 🚀 问题修复

### 1. Git克隆错误修复

**问题**: `fatal: destination path 'mtproxy-manager' already exists and is not an empty directory.`

**解决方案**: 在安装脚本中添加了目录检查和清理：

```bash
# 检查并删除已存在的目录
if [[ -d "mtproxy-manager" ]]; then
    print_warning "删除已存在的目录: /tmp/mtproxy-manager"
    rm -rf mtproxy-manager
fi
git clone https://github.com/OrangeKing92/mtproxy-manager.git
```

### 2. 交互式配置功能

参考 [sunpma/mtp](https://github.com/sunpma/mtp.git) 项目，添加了完整的交互式配置功能。

## 📱 交互式安装流程演示

### 启动安装
```bash
bash <(curl -fsSL https://raw.githubusercontent.com/OrangeKing92/mtproxy-manager/main/install_interactive.sh)
```

### 安装界面
```
    __  __  _______  _____                       
   |  \/  ||__   __|  __ \                      
   | \  / |   | |  | |__) |_ __   ___  __  __  _ 
   | |\/| |   | |  |  ___/| '__| / _ \ \\\/  || | | |
   | |  | |   | |  | |    | |   | (_) |>  <| |_| |
   |_|  |_|   |_|  |_|    |_|   \___//_/\_\____/

      Telegram MTProxy Manager v3.1
      https://github.com/OrangeKing92/mtproxy-manager

MTProxy Manager - Python实现的Telegram代理

✨ 特性:
• 🔧 一键安装 - 全自动化部署
• 🎛️ 交互式配置 - 简单易用的配置向导
• 🌐 Web管理 - 完整的Web管理界面
• 🔒 安全可靠 - TLS支持，自动密钥生成
• ⚡ 高性能 - 异步架构，支持高并发

项目地址: https://github.com/OrangeKing92/mtproxy-manager

是否开始安装MTProxy Manager？ [Y/n]: Y
```

### 服务器信息检测
```
════════════════════════════════════════
获取服务器信息
════════════════════════════════════════

[INFO] 获取服务器信息...

服务器信息:
• IP地址: 123.456.789.123
• 系统: Ubuntu 22.04.3 LTS
• 架构: x86_64
• 内存: 2.0Gi
```

### 交互式配置向导
```
════════════════════════════════════════
交互式配置向导
════════════════════════════════════════

请根据提示输入配置信息，直接按回车使用默认值

请输入客户端连接端口 [默认: 443]: 8443
请输入管理端口 [默认: 8080]: 8080

伪装域名选择:
1) azure.microsoft.com (推荐)
2) cdn.cloudflare.com
3) www.google.com
4) 自定义域名

请选择伪装域名 [默认: 1]: 1
请输入推广TAG (可选，直接回车跳过): 
请输入管理员密码 [默认: admin123]: mypassword123
```

### 配置确认
```
════════════════════════════════════════
配置信息确认
════════════════════════════════════════

服务器IP: 123.456.789.123
客户端端口: 8443
管理端口: 8080
伪装域名: azure.microsoft.com
推广TAG: 无
管理员密码: mypassword123

确认配置信息是否正确？ [Y/n]: Y
[SUCCESS] 配置信息已保存
```

### 自动安装过程
```
════════════════════════════════════════
安装系统依赖
════════════════════════════════════════

[INFO] 更新包管理器...
[SUCCESS] Python版本检查通过: 3.11

════════════════════════════════════════
安装MTProxy
════════════════════════════════════════

[SUCCESS] 创建用户: mtproxy
[INFO] 下载代码...
[INFO] 安装Python依赖...
[SUCCESS] MTProxy安装完成

════════════════════════════════════════
生成配置文件
════════════════════════════════════════

[SUCCESS] 配置文件已生成

════════════════════════════════════════
配置系统服务
════════════════════════════════════════

[SUCCESS] 服务配置完成

════════════════════════════════════════
启动服务
════════════════════════════════════════

[SUCCESS] 服务启动成功
```

### 安装完成界面
```
    __  __  _______  _____                       
   |  \/  ||__   __|  __ \                      
   | \  / |   | |  | |__) |_ __   ___  __  __  _ 
   | |\/| |   | |  |  ___/| '__| / _ \ \\\/  || | | |
   | |  | |   | |  | |    | |   | (_) |>  <| |_| |
   |_|  |_|   |_|  |_|    |_|   \___//_/\_\____/

════════════════════════════════════════
🎉 安装完成
════════════════════════════════════════

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📱 Telegram连接信息
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🌐 服务器IP: 123.456.789.123
🔌 端口: 8443
🔑 密钥: 1234567890abcdef1234567890abcdef
🎭 伪装域名: azure.microsoft.com

📋 连接链接:
https://t.me/proxy?server=123.456.789.123&port=8443&secret=ee1234567890abcdef1234567890abcdefazure.microsoft.com

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔧 管理面板
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🌐 访问地址: http://123.456.789.123:8080
👤 用户名: admin
🔒 密码: mypassword123

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📖 常用命令
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

mtproxy          # 打开管理面板
mtproxy status   # 查看运行状态
mtproxy restart  # 重启服务
mtproxy logs     # 查看运行日志
mtproxy stop     # 停止服务

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[SUCCESS] 🎊 MTProxy安装完成！请保存上述连接信息
```

## 🆚 与 sunpma/mtp 的对比

### sunpma/mtp 特点:
- 简单的绿色版安装
- 基础的交互式配置
- Shell脚本管理

### 我们的改进:
- ✅ **更丰富的交互式配置**: 端口冲突检测、域名选择、密码验证
- ✅ **更美观的界面**: 彩色输出、ASCII艺术、表格化信息
- ✅ **更完整的功能**: Python实现、Web管理界面、systemd服务
- ✅ **更好的错误处理**: 自动清理、重试机制、详细提示
- ✅ **更强的扩展性**: 模块化设计、配置文件驱动

## 🔗 使用方法

### 交互式安装 (推荐)
```bash
bash <(curl -fsSL https://raw.githubusercontent.com/OrangeKing92/mtproxy-manager/main/install_interactive.sh)
```

### 标准安装
```bash
bash <(curl -fsSL https://raw.githubusercontent.com/OrangeKing92/mtproxy-manager/main/install.sh)
```

## 📋 已修复的问题

1. ✅ **Git克隆目录冲突**: 自动检测并清理已存在目录
2. ✅ **缺少交互式配置**: 完整的配置向导，参考sunpma/mtp设计
3. ✅ **用户体验不佳**: 美观的界面设计和详细的进度提示
4. ✅ **错误处理不完善**: 端口冲突检测、输入验证、重试机制

现在的安装脚本提供了比sunpma/mtp更加完善和用户友好的安装体验! 🎉
